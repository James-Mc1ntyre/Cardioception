
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Fitting a psychometric function at the subject level &#8212; cardioception 0.4.3 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/thebelab-helper.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/logo_small.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fitting a psychometric function at the group level" href="2-psychophysics_group_level.html" />
    <link rel="prev" title="Heart Rate Discrimination task - Summary results" href="../templates/HeartRateDiscrimination.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="None">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    <img src="../../_static/logo_small.svg" class="logo__image only-light" alt="Logo image">
    <img src="../../_static/logo_small.svg" class="logo__image only-dark" alt="Logo image">
  
  
    <p class="title logo__title">Cardioception</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../measuring.html">
  Theory
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user_guide.html">
  Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../stats.html">
  Statistical analysis
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../cite.html">
  Cite
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../references.html">
  References
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/embodied-computation-group/Cardioception" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/visceral_mind" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/Cardioception/" rel="noopener" target="_blank" title="Pypi"><span><i class="fas fa-box"></i></span>
            <label class="sr-only">Pypi</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<div class="sidebar-primary col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>


          


<div class="bd-sidebar-secondary d-none d-md-block col-md-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Fitting a psychometric function at the subject level
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model">
   Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting">
   Plotting
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-8">
              
              <article class="bd-article" role="main">
                
  <section class="tex2jax_ignore mathjax_ignore" id="fitting-a-psychometric-function-at-the-subject-level">
<span id="psychophysics-subject-level"></span><h1>Fitting a psychometric function at the subject level<a class="headerlink" href="#fitting-a-psychometric-function-at-the-subject-level" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">arviz</span>
    <span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pymc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aesara.tensor</span> <span class="k">as</span> <span class="nn">at</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;talk&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [2],</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">aesara.tensor</span> <span class="k">as</span> <span class="nn">at</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">arviz</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="n">_log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="s2">&quot;arviz&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="kn">from</span> <span class="nn">.data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="kn">from</span> <span class="nn">.plots</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="kn">from</span> <span class="nn">.plots.backends</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">arviz</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="sd">&quot;&quot;&quot;Code for loading and manipulating data structures.&quot;&quot;&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">CoordSpec</span><span class="p">,</span> <span class="n">DimSpec</span><span class="p">,</span> <span class="n">dict_to_dataset</span><span class="p">,</span> <span class="n">numpy_to_data_array</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">.converters</span> <span class="kn">import</span> <span class="n">convert_to_dataset</span><span class="p">,</span> <span class="n">convert_to_inference_data</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">.datasets</span> <span class="kn">import</span> <span class="n">clear_data_home</span><span class="p">,</span> <span class="n">list_datasets</span><span class="p">,</span> <span class="n">load_arviz_data</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">arviz</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="kn">import</span> <span class="nn">ujson</span> <span class="k">as</span> <span class="nn">json</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xarray</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">testing</span><span class="p">,</span> <span class="n">tutorial</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">.backends.api</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">load_dataarray</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">load_dataset</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">save_mfdataset</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">.backends.rasterio_</span> <span class="kn">import</span> <span class="n">open_rasterio</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xarray</span><span class="o">/</span><span class="n">testing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">xarray.core</span> <span class="kn">import</span> <span class="n">duck_array_ops</span><span class="p">,</span> <span class="n">formatting</span><span class="p">,</span> <span class="n">utils</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">xarray.core.dataarray</span> <span class="kn">import</span> <span class="n">DataArray</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">xarray.core.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xarray</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">duck_array_ops</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">take</span><span class="p">,</span> <span class="n">tensordot</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">unravel_index</span>  <span class="c1"># noqa</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">where</span> <span class="k">as</span> <span class="n">_where</span>
<span class="ne">---&gt; </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">dask_array_compat</span><span class="p">,</span> <span class="n">dask_array_ops</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">npcompat</span><span class="p">,</span> <span class="n">nputils</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="kn">from</span> <span class="nn">.nputils</span> <span class="kn">import</span> <span class="n">nanfirst</span><span class="p">,</span> <span class="n">nanlast</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="kn">from</span> <span class="nn">.pycompat</span> <span class="kn">import</span> <span class="n">cupy_array_type</span><span class="p">,</span> <span class="n">dask_array_type</span><span class="p">,</span> <span class="n">is_duck_dask_array</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.9.13</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">xarray</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">npcompat</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">72</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>     <span class="kn">from</span> <span class="nn">numpy.typing._dtype_like</span> <span class="kn">import</span> <span class="n">_DTypeLikeNested</span><span class="p">,</span> <span class="n">_ShapeLike</span><span class="p">,</span> <span class="n">_SupportsDType</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>     <span class="c1"># Xarray requires a Mapping[Hashable, dtype] in many places which</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>     <span class="c1"># conflics with numpys own DTypeLike (with dtypes for fields).</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>     <span class="c1"># https://numpy.org/devdocs/reference/typing.html#numpy.typing.DTypeLike</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>     <span class="c1"># This is a copy of this DTypeLike that allows only non-Mapping dtypes.</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>     <span class="n">DTypeLikeSave</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>         <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>         <span class="c1"># default data type (float64)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>         <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>         <span class="c1"># array-scalar types and generic types</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>         <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>         <span class="c1"># character codes, type strings or comma-separated fields, e.g., &#39;float64&#39;</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>         <span class="nb">str</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>         <span class="c1"># (flexible_dtype, itemsize)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>         <span class="n">Tuple</span><span class="p">[</span><span class="n">_DTypeLikeNested</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>         <span class="c1"># (fixed_dtype, shape)</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>         <span class="n">Tuple</span><span class="p">[</span><span class="n">_DTypeLikeNested</span><span class="p">,</span> <span class="n">_ShapeLike</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>         <span class="c1"># (base_dtype, new_dtype)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>         <span class="n">Tuple</span><span class="p">[</span><span class="n">_DTypeLikeNested</span><span class="p">,</span> <span class="n">_DTypeLikeNested</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>         <span class="c1"># because numpy does the same?</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>         <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>         <span class="c1"># anything with a dtype attribute</span>
<span class="ne">---&gt; </span><span class="mi">72</span>         <span class="n">_SupportsDType</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>     <span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>     <span class="c1"># fall back for numpy &lt; 1.20, ArrayLike adapted from numpy.typing._array_like</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>     <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.13/x64/lib/python3.9/typing.py:277,</span> in <span class="ni">_tp_cache.&lt;locals&gt;.decorator.&lt;locals&gt;.inner</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span> <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span>     <span class="k">pass</span>  <span class="c1"># All real errors (not unhashable args) are raised below.</span>
<span class="ne">--&gt; </span><span class="mi">277</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.13/x64/lib/python3.9/typing.py:1004,</span> in <span class="ni">Generic.__class_getitem__</span><span class="nt">(cls, params)</span>
<span class="g g-Whitespace">   </span><span class="mi">1000</span>         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1001</span>             <span class="sa">f</span><span class="s2">&quot;Parameters to </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[...] must all be unique&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1002</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span>     <span class="c1"># Subscripting a regular Generic subclass.</span>
<span class="ne">-&gt; </span><span class="mi">1004</span>     <span class="n">_check_generic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__parameters__</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1005</span> <span class="k">return</span> <span class="n">_GenericAlias</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.13/x64/lib/python3.9/site-packages/typing_extensions.py:92,</span> in <span class="ni">_check_generic</span><span class="nt">(cls, parameters, elen)</span>
<span class="g g-Whitespace">     </span><span class="mi">88</span> <span class="sd">&quot;&quot;&quot;Check correct count for parameters of a generic cls (internal helper).</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span><span class="sd"> This gives a nice error message in case of count mismatch.</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">91</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">elen</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">92</span>     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s2"> is not a generic class&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span> <span class="k">if</span> <span class="n">elen</span> <span class="ow">is</span> <span class="n">_marker</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span>     <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;__parameters__&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__parameters__</span><span class="p">:</span>

<span class="ne">TypeError</span>: &lt;class &#39;numpy.typing._dtype_like._SupportsDType&#39;&gt; is not a generic class
</pre></div>
</div>
</div>
</div>
<p>In this example, we are going to fit a cummulative normal function to decision responses made during the Heart Rate Discrimination task. We are going to use the data from the <a class="reference external" href="https://www.biorxiv.org/content/10.1101/2021.02.18.431871v1">HRD method paper</a> <span id="id1">[<a class="reference internal" href="../../references.html#id4" title="Nicolas Legrand, Niia Nikolova, Camile Correa, Malthe Brændholt, Anna Stuckert, Nanna Kildahl, Melina Vejlø, Francesca Fardo, and Micah Allen. The heart rate discrimination task: a psychophysical method to estimate the accuracy and precision of interoceptive beliefs. Biological Psychology, 168:108239, 2022. URL: https://www.sciencedirect.com/science/article/pii/S0301051121002325, doi:https://doi.org/10.1016/j.biopsycho.2021.108239.">Legrand <em>et al.</em>, 2022</a>]</span> and analyse the responses from one participant from the second session.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data frame</span>
<span class="n">psychophysics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://github.com/embodied-computation-group/CardioceptionPaper/raw/main/data/Del2_merged.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, let’s filter this data frame so we only keep subject 19 (<code class="docutils literal notranslate"><span class="pre">sub_0019</span></code> label) and the interoceptive condition (<code class="docutils literal notranslate"><span class="pre">Extero</span></code> label).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">this_df</span> <span class="o">=</span> <span class="n">psychophysics_df</span><span class="p">[(</span><span class="n">psychophysics_df</span><span class="o">.</span><span class="n">Modality</span> <span class="o">==</span> <span class="s1">&#39;Extero&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">psychophysics_df</span><span class="o">.</span><span class="n">Subject</span> <span class="o">==</span> <span class="s1">&#39;sub_0019&#39;</span><span class="p">)]</span>
<span class="n">this_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TrialType</th>
      <th>Condition</th>
      <th>Modality</th>
      <th>StairCond</th>
      <th>Decision</th>
      <th>DecisionRT</th>
      <th>Confidence</th>
      <th>ConfidenceRT</th>
      <th>Alpha</th>
      <th>listenBPM</th>
      <th>...</th>
      <th>EstimatedThreshold</th>
      <th>EstimatedSlope</th>
      <th>StartListening</th>
      <th>StartDecision</th>
      <th>ResponseMade</th>
      <th>RatingStart</th>
      <th>RatingEnds</th>
      <th>endTrigger</th>
      <th>HeartRateOutlier</th>
      <th>Subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>psi</td>
      <td>Less</td>
      <td>Extero</td>
      <td>psi</td>
      <td>Less</td>
      <td>2.216429</td>
      <td>59.0</td>
      <td>1.632995</td>
      <td>-0.5</td>
      <td>78.0</td>
      <td>...</td>
      <td>22.805550</td>
      <td>12.549457</td>
      <td>1.603353e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>False</td>
      <td>sub_0019</td>
    </tr>
    <tr>
      <th>3</th>
      <td>psiCatchTrial</td>
      <td>Less</td>
      <td>Extero</td>
      <td>psiCatchTrial</td>
      <td>Less</td>
      <td>1.449154</td>
      <td>100.0</td>
      <td>0.511938</td>
      <td>-30.0</td>
      <td>82.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>False</td>
      <td>sub_0019</td>
    </tr>
    <tr>
      <th>6</th>
      <td>psi</td>
      <td>More</td>
      <td>Extero</td>
      <td>psi</td>
      <td>More</td>
      <td>1.182666</td>
      <td>95.0</td>
      <td>0.606786</td>
      <td>22.5</td>
      <td>69.0</td>
      <td>...</td>
      <td>10.001882</td>
      <td>12.884902</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>False</td>
      <td>sub_0019</td>
    </tr>
    <tr>
      <th>10</th>
      <td>psi</td>
      <td>More</td>
      <td>Extero</td>
      <td>psi</td>
      <td>More</td>
      <td>1.848141</td>
      <td>24.0</td>
      <td>1.448969</td>
      <td>10.5</td>
      <td>62.0</td>
      <td>...</td>
      <td>0.998384</td>
      <td>13.044744</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>False</td>
      <td>sub_0019</td>
    </tr>
    <tr>
      <th>11</th>
      <td>psiCatchTrial</td>
      <td>More</td>
      <td>Extero</td>
      <td>psiCatchTrial</td>
      <td>More</td>
      <td>1.349469</td>
      <td>75.0</td>
      <td>0.561820</td>
      <td>10.0</td>
      <td>72.0</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>1.603354e+09</td>
      <td>False</td>
      <td>sub_0019</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div></div></div>
</div>
<p>This data frame contain a large number of columns, but here we will be interested in the <code class="docutils literal notranslate"><span class="pre">Alpha</span></code> column (the intensity value) and the <code class="docutils literal notranslate"><span class="pre">Decision</span></code> column (the response made by the participant).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">this_df</span> <span class="o">=</span> <span class="n">this_df</span><span class="p">[[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;Decision&#39;</span><span class="p">]]</span>
<span class="n">this_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Alpha</th>
      <th>Decision</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>-0.5</td>
      <td>Less</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-30.0</td>
      <td>Less</td>
    </tr>
    <tr>
      <th>6</th>
      <td>22.5</td>
      <td>More</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10.5</td>
      <td>More</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10.0</td>
      <td>More</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>These two columns are enought for us to extract the 3 vectors of interest to fit a psychometric function:</p>
<ul class="simple">
<li><p>The intensity vector, listing all the tested intensities values</p></li>
<li><p>The total number of trials for each tested intensity value</p></li>
<li><p>The number of “correct” response (here, when the decision == ‘More’).</p></li>
</ul>
<p>Let’s take a look at the data. This function will plot the proportion of “Faster” responses depending on the intensity value of the trial stimuli (expressed in BPM). Here, the size of the circle represent the number of trials that were presented for each intensity values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Decision</span> <span class="o">==</span> <span class="s1">&#39;More&#39;</span><span class="p">))</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">resp</span><span class="o">/</span><span class="n">total</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#4c72b0&#39;</span><span class="p">,</span> 
             <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">total</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P$_{(Response = More|Intensity)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Intensity ($\Delta$ BPM)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1cda0e156c39cf1108ef59fcfd25e22f6d1abebff6c64e99fb021b258c8f4ced.png" src="../../_images/1cda0e156c39cf1108ef59fcfd25e22f6d1abebff6c64e99fb021b258c8f4ced.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="model">
<h1>Model<a class="headerlink" href="#model" title="Permalink to this headline">#</a></h1>
<p>The model was defined by:</p>
<img src="https://raw.githubusercontent.com/embodied-computation-group/Cardioception/master/docs/source/images/images/psychophysics_subject_level.png" align = 'left' alt="drawing" width="200"/>
<div class="math notranslate nohighlight">
\[ r_{i} \sim \mathcal{Binomial}(\theta_{i},n_{i})\]</div>
<div class="math notranslate nohighlight">
\[ \Phi_{i}(x_{i}, \alpha, \beta) = \frac{1}{2} + \frac{1}{2} * erf(\frac{x_{i} - \alpha}{\beta * \sqrt{2}})\]</div>
<div class="math notranslate nohighlight">
\[ \alpha \sim \mathcal{Uniform}(-40.5, 40.5)\]</div>
<div class="math notranslate nohighlight">
\[ \beta \sim  |\mathcal{Normal}(0, 10)|\]</div>
<p>Where <span class="math notranslate nohighlight">\(erf\)</span> denotes the <a class="reference external" href="https://en.wikipedia.org/wiki/Error_function">error functions</a> and <span class="math notranslate nohighlight">\(\phi\)</span> is the cumulative normal function.</p>
<p>We create our own PyMC3 compatible cumulative normal distribution function here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cumulative_normal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="c1"># Cumulative distribution function for the standard normal distribution</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">at</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">at</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>We preprocess the data to extract the intensity <span class="math notranslate nohighlight">\(x\)</span>, the number or trials <span class="math notranslate nohighlight">\(n\)</span> and number of hit responses <span class="math notranslate nohighlight">\(r\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">163</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">163</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">163</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">40.5</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
    <span class="n">n</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span>
    <span class="n">r</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Decision</span> <span class="o">==</span> <span class="s2">&quot;More&quot;</span><span class="p">))</span>

<span class="c1"># remove no responses trials</span>
<span class="n">validmask</span> <span class="o">=</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">xij</span><span class="p">,</span> <span class="n">nij</span><span class="p">,</span> <span class="n">rij</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">validmask</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">validmask</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">validmask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Create the model and sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">subject_psychophysics</span><span class="p">:</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">40.5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">40.5</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">thetaij</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span>
        <span class="s2">&quot;thetaij&quot;</span><span class="p">,</span> <span class="n">cumulative_normal</span><span class="p">(</span><span class="n">xij</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">rij_</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Binomial</span><span class="p">(</span><span class="s2">&quot;rij&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">thetaij</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nij</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">rij</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">subject_psychophysics</span><span class="p">:</span>
    <span class="n">idata</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">chains</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [alpha, beta]
</pre></div>
</div>
<div class="output text_html">
    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
      100.00% [8000/8000 00:01<00:00 Sampling 4 chains, 0 divergences]
    </div>
    </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 2 seconds.
The acceptance probability does not match the target. It is 0.8871, but should be close to 0.8. Try to increase the number of tuning steps.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8b189c0d2d00dd86caa6c59280b74a1e37a04e51a7f92b80bbebdb4c1745cdd9.png" src="../../_images/8b189c0d2d00dd86caa6c59280b74a1e37a04e51a7f92b80bbebdb4c1745cdd9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">])</span>
<span class="n">stats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>alpha</th>
      <td>2.170</td>
      <td>1.576</td>
      <td>-0.885</td>
      <td>5.059</td>
      <td>0.027</td>
      <td>0.021</td>
      <td>3369.0</td>
      <td>2596.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>beta</th>
      <td>7.422</td>
      <td>1.832</td>
      <td>4.417</td>
      <td>10.715</td>
      <td>0.033</td>
      <td>0.024</td>
      <td>2988.0</td>
      <td>2653.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Interpretation</strong>: Here, <span class="math notranslate nohighlight">\(\alpha\)</span> refers to the threshold value (also the point of subjective equality for this design). This participant had a threshold at estimated at 2.25, which is just slightly positively biased. The <span class="math notranslate nohighlight">\(\beta\)</span> value refers to the slope. A higher value means lower precision. Here, the slope is estimated to be around 7.46 for this participant.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="plotting">
<h1>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">#</a></h1>
<p>Extrace the last 10 sample of each chain (here we have 4).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_samples</span> <span class="o">=</span> <span class="n">idata</span><span class="p">[</span><span class="s2">&quot;posterior&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">beta_samples</span> <span class="o">=</span> <span class="n">idata</span><span class="p">[</span><span class="s2">&quot;posterior&quot;</span><span class="p">][</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Draw some sample from the traces</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">alpha_samples</span><span class="p">,</span> <span class="n">beta_samples</span><span class="p">):</span>
  <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> 
          <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">b</span><span class="p">)),</span>
          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.08</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Plot psychometric function with average parameters</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> 
        <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">slope</span><span class="p">)),</span>
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#4c72b0&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Draw circles showing response proportions</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Decision</span> <span class="o">==</span> <span class="s1">&#39;More&#39;</span><span class="p">))</span>
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">this_df</span><span class="o">.</span><span class="n">Alpha</span> <span class="o">==</span> <span class="n">intensity</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">resp</span><span class="o">/</span><span class="n">total</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#4c72b0&#39;</span><span class="p">,</span> 
             <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">total</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P$_{(Response = More|Intensity)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Intensity ($\Delta$ BPM)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/66e9edeac3cfd0c62048ef5ea5527229f85667508e17f584390bec1217311882.png" src="../../_images/66e9edeac3cfd0c62048ef5ea5527229f85667508e17f584390bec1217311882.png" />
</div>
</div>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="../templates/HeartRateDiscrimination.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Heart Rate Discrimination task - Summary results</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="2-psychophysics_group_level.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Fitting a psychometric function at the group level</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022-2022, Nicolas Legrand.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>